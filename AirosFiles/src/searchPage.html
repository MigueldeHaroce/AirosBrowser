<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Electron Tabs Example</title>
  <link rel="stylesheet" href="searchPage.css" />
</head>
  <body>
    <div class="top-bar">
      <h1></h1>
      <style>
      </style>
      <div class="icons">
      <div class="icon-container">
          <button id="minimizeBtn" class="icon-btn" aria-label="Minimize">
          <img src="icons/minus.svg" id="imgMinimize">
          <style>
              #imgMinimize {
                  padding: 18px;
              }
          </style>
          </button>
      </div>
      <div class="icon-container">
          <button id="restoreBtn" class="icon-btn" aria-label="Restore">
          <img src="icons/restore.svg" id="imgRestore">
          <style>
              #imgRestore {
                  padding: 18px;
              }
          </style>
          </button>
      </div>
      <div class="icon-container">
          <button id="closeBtn" class="icon-btn" aria-label="Close">
          <img src="icons/x.svg" id="imgClose">
          <style>
              #imgClose {
                  padding: 18px;
              }
          </style>
          </button>
          </div>
      </div>
    </div>  
      
    <tab-group new-tab-button="true" sortable="true">
      <style>
        :host {
          --tab-border-color: transparent;
          --button-hover-background: #444;
          --tab-color: #ddd;
          --tab-active-color: #ddd;
          --tab-active-background: #ddd;
          --tag-hover-color: #ddd;
          --button-font-size: 20px;
          --button-border-radius: 50%;
        }

        .tab-title {
          width: 50px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .tab.visible {
          background-color: #202020;
        }
        .tab.active {
          color: var(--tab-color);
          background-color: #444;
        }
        .tab:not(.active):hover {
          color: var(--tab-color);
          background-color: #333;
        }
        .tab-close button {
          color: var(--tab-color);
        }
        .nav {
          background-color: transparent;
        }

        .etabs {
          background-color: transparent;
        }

        .buttons {
          padding: 1px;
        }
        .buttons button:hover {
          padding: 1px;
        }

        .views {
          position: fixed;
          height: calc(100vh - 33px);
          top: 45px;
          width: 100%;
          left: 0px;
        }
      </style>
    </tab-group>

    <script src="electron-tabs/dist/electron-tabs.js"></script>
    <script>

      const query = []; 

      let finalResults;

      const searchHistory = [];

      const tabGroup = document.querySelector("tab-group");
      const searchID = new URLSearchParams(window.location.search).get("searchID");

      // Pull your search
      ipcRenderer.send('pull-search', searchID);

      ipcRenderer.on('search-results', (results) => {
        console.log(results);
        if (results) {

          console.log(results + '|' + query);

          query.push(results);
          
          finalResults = results;

          console.log(query[0]);
          // Add the search result to the search history
          searchHistory.push(results);
        } else {
          console.error('Error: searchResults or results is undefined.');
        }
      });

      tabGroup.addTab({
          title: "no changes",
          active: true,
      });

      console.log(finalResults);

      tabGroup.on('tab-added', (tab) => {
        const webview = tab.webview;

        console.log("ad");

        tab.setTitle("changes");

        webview.loadURL(query[0]);
      });
    
      tabGroup.on('tab-added', (tab) => {
        const webview = tab.webview;

        webview.addEventListener('page-title-updated', () => {
          // Set tab title based on web page title
          const tabTitle = webview.getTitle();
          tab.setTitle(`<img class="tab-logo" src=""/>${tabTitle}`);
        });

        webview.addEventListener('dom-ready', async () => {
          // Set tab logo based on favicon
          let faviconURL;
          const webviewURL = webview.getURL();

          if (webviewURL.includes('google.com')) {
            // Use a fallback favicon URL for google.com
            faviconURL = 'https://www.google.com/favicon.ico';
          } else {
            faviconURL = await getFaviconURL(webviewURL);
          }

          if (faviconURL) {
            tab.setIcon(faviconURL);
          }
        });
      });

      ipcRenderer.on('addHistoryList', (results) => {
        searchHistory.push(results);
        console.log(searchHistory);
      });
    
      tabGroup.setDefaultTab({
        title: "New Page",
        src: "https://www.google.com/",
        active: true
      });

    </script>    
    <script src="appFunctions.js" defer type="module"></script>
    <script src="renderer.js" defer type="module"></script>  
  </body>
</html>